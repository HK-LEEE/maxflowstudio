## **AI 개발 가이드: No-Code 기반 LLMOps 플랫폼 (v1.2)**

이 문서는 'Flow as a Service' 기반의 No-Code LLMOps 플랫폼 개발을 위한 기술, 아키텍처, 개발 표준 및 주요 설정 정보를 정의합니다. 모든 개발자는 본 문서를 숙지하고 개발에 참고해야 합니다.

---

### **1. 프로젝트 개요**

*   **프로젝트명**: MAX Flowstudio
*   **목표**: Flow as a service를 기반으로 No-Code LLMOps 플랫폼 개발
*   **핵심 컨셉**: 사용자가 GUI(Flowise, Langflow와 유사)를 통해 LLM 워크플로우를 시각적으로 설계하고, 이를 API로 배포하여 채팅 등 다양한 서비스에서 활용할 수 있는 플랫폼을 구축한다.

---

### **2. 시스템 아키텍처**

#### **2.1. 개념도**

```
[사용자] <--> [Frontend: React/React-Flow] <--> [Backend: FastAPI (Web-Tier)]
                                                     |
                                                     V
                                         [Workflow Engine (Orchestrator)]
                                                     |
                                                     V
                                         [Task Queue (RabbitMQ)]
                                                     |
                                                     V
                                            [Worker(s) (Python)]
                                                     |
                                                     V
                                     [실제 작업 수행 (LLM API 호출 등)]

          [모든 컴포넌트] <--> [Database: PostgreSQL (모든 영속적 데이터 저장)]
```

#### **2.2. 컴포넌트별 역할**

| 컴포넌트 | 역할 |
| :--- | :--- |
| **웹-티어 (API 서버)** | 사용자의 요청(플로우 생성/수정/삭제, 실행 요청 등)을 받는 API 진입점 |
| **플로우 디자이너 (Frontend)** | 사용자가 웹 브라우저에서 드래그 앤 드롭으로 워크플로우를 시각적으로 설계하는 UI |
| **워크플로우 엔진 (Orchestrator)** | 플로우 실행을 총괄하는 두뇌. 정의된 플로우를 해석하고, 각 단계를 Task로 분해하여 Task Queue에 전달 |
| **작업 큐 (Task Queue)** | 워크플로우 엔진과 워커 사이의 비동기 작업을 전달하는 통로. 시스템 확장성 및 안정성 보장 |
| **워커 (Worker)** | Task Queue로부터 작업을 받아 실제 로직(LLM API 호출, 데이터 처리 등)을 수행하는 실행자 |
| **데이터베이스 (Database)** | 플로우 정의(JSON), 실행 이력 및 상태, 사용자 정보, 로그 등 **모든 영속적 데이터를 저장하는 중앙 저장소**. 시스템의 상태와 모든 사용자 생성물을 보존하는 핵심 요소 |

---

### **3. 기술 스택 및 개발 환경**

| 구분 | 기술/도구 | 버전/세부사항 | 비고 |
| :--- | :--- | :--- | :--- |
| **운영 환경** | Windows / Mac | - | 개발 및 운영 환경 |
| **Frontend** | Node.js | v22 | |
| | UI Framework | React | UI 구현 |
| | Flow Editor | React Flow | 시각적 플로우 설계 도구 |
| **Backend** | Python | v3.11 | |
| | Web Framework | FastAPI | 비동기 API 서버 구축 |
| **Workflow Engine** | Custom | Asyncio + Multiprocessing | 직접 구현하여 유연성 확보 |
| **Task Queue** | RabbitMQ | - | 안정적인 메시지 큐잉 시스템 |
| **Worker** | Python 스크립트 | PyInstaller, NSSM (Windows) | Windows 환경에서 서비스로 안정적 운영 |
| **Database** | PostgreSQL | - | Flow Definition, Execution State 통합 관리 |

---

### **4. 개발 가이드라인 및 컨벤션**

#### **4.1. 공통 원칙 (매우 중요)**

1.  **컴포넌트 분리 원칙**: 각 모듈/컴포넌트는 독립적으로 작동하도록 설계하고, 다른 컴포넌트에 대한 의존성을 최소화합니다.
2.  **소스 흐름도 작성**: 파일 최상단에 주석으로 해당 파일의 핵심 로직, 함수 호출 관계 등 흐름도를 명시하여 코드 가독성을 극대화합니다.
3.  **파일 길이 제한**: **1개 파일의 코드는 500줄을 넘지 않도록 합니다.** 500줄 초과가 예상될 경우, 기능 분리 및 리팩토링을 통해 파일을 분할합니다.
4.  **데이터 영속성 설계 원칙**:
    *   **저장 대상**: 사용자가 생성/수정하는 모든 정보(플로우, 노드 설정, API 키 등)와 시스템이 생성하는 주요 데이터(실행 이력, 상태 로그 등)는 **반드시 DB에 저장**되어야 합니다.
    *   **저장 시점**: '저장' 버튼과 같이 명시적인 사용자 액션이 있는 기능은 물론, 플로우 실행 시작/종료 등 상태 변화가 발생하는 모든 핵심 로직에는 데이터베이스 저장/업데이트 로직이 **필수적으로 포함**되어야 합니다.

#### **4.2. Python 백엔드 개발 표준**

1.  **타입 힌트 (Type Hints)**: 모든 함수와 변수에 대해 타입 힌트를 **필수**로 사용하여 코드 안정성과 가독성을 높입니다.
2.  **의존성 관리**: `pyproject.toml` 파일을 통해 프로젝트 의존성을 명확하고 재현 가능하게 관리합니다. (`requirements.txt` 사용 지양)
3.  **코드 포매터/린터**: **Black(포매터)**과 **Ruff(린터)**를 도입하여 일관된 코드 스타일을 유지하고 잠재적 오류를 사전에 방지합니다.
4.  **최신 Python 문법**: Python 3.10 이상의 최신 문법(예: `match-case`, `|` union types)을 적극 활용하여 간결하고 효율적인 코드를 작성합니다.
5.  **비동기 프로그래밍**: FastAPI의 장점을 극대화하기 위해 `async/await`를 정확히 이해하고, I/O bound 작업에 적극적으로 적용합니다.
6.  **테스트 코드**: `pytest`를 사용하여 핵심 로직에 대한 단위/통합 테스트 코드를 작성하여 코드의 신뢰성을 확보합니다.
7.  **설정 및 보안 정보 분리**: DB 접속 정보, API 키 등 민감 정보는 소스 코드에 하드코딩하지 않고, 환경 변수나 별도의 설정 파일(.env)로 분리하여 관리합니다.
8.  **Pythonic Code**: 간결하고 명료한 파이썬다운(Pythonic) 코드를 작성합니다. (예: list comprehension, generator 사용)
9.  **로깅**: 디버깅 및 운영 추적을 위해 `print()` 대신 `logging` 모듈을 사용합니다. 로그 레벨(INFO, DEBUG, ERROR 등)을 명확히 구분합니다.
10. **프로젝트 구조**: `src-layout`을 채택하여 소스 코드와 테스트/설정 파일을 명확히 분리합니다.

---

### **5. 주요 설정 및 계정 정보**

#### **5.1. (추가) 실행 환경 설정**

모든 실행 환경 정보는 **환경 변수(.env 파일 등)로 관리**하며, 소스 코드에 절대 하드코딩하지 않습니다.

| 구분 | 호스트/포트 | 환경 변수 (예시) | 비고 |
| :--- | :--- | :--- | :--- |
| **Backend** | `localhost:8005` | `BACKEND_HOST=localhost`<br>`BACKEND_PORT=8005` | FastAPI 서버 실행 |
| **Frontend**| `localhost:3005` | `REACT_APP_API_URL=http://localhost:8005` | React 개발 서버 실행 |

#### **5.2. Database (PostgreSQL)**

*   **IP Address**: `172.28.32.1`
*   **Port**: `5432`
*   **ID**: `postgres`
*   **Password**: `2300`
*   **환경 변수 (예시)**: `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`
*   **주의**: **상기 계정 정보는 개발용입니다.** 환경 변수를 통해 관리해야 합니다.

#### **5.3. 인증 및 권한**

*   **인증 처리**: **(수정)** `localhost:8005` (백엔드 API 서버)를 통해 인증을 수행합니다.
*   **회원 가입**: 가입 기능은 직접 구현하지 않고, `MAXplatform`으로 리다이렉트하여 처리합니다.
*   **권한 확인**: 로그인된 사용자의 권한 정보는 `me` API를 호출하여 확인하고, API 접근 제어에 활용합니다.

---

### **6. 참고 자료**

*   **코드 레퍼런스**: `langflow-main` 폴더의 `backend`, `frontend` 구조와 코드를 참고하여 프로젝트 구조 및 초기 구현 방향을 설정합니다.
*   **인증 로직 레퍼런스**: `MAXDP` 폴더의 관련 자료를 참고하여 인증/권한 로직을 구현합니다.